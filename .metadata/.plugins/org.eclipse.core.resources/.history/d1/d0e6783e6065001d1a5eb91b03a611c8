/**
 * 
 */
package com.tcs.dao;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.Scanner;

/**
 * @author Administrator
 *
 */
public class AdminDaoImp implements AdminDaoInterface{
	
	ConnectionClass cc = new ConnectionClass();
	Connection conn = cc.connect();
	PreparedStatement pr = null;
	Scanner sc = new Scanner(System.in);
	
	@Override
	public void approvalForStudent() {
		// TODO Auto-generated method stub
		String sql = "SELECT username,isApproved FROM Login";
		try {
			pr = conn.prepareStatement(sql);
			ResultSet rs = pr.executeQuery(sql);
			while(rs.next()) {
				if(rs.getInt("isApproved")==0) {
					System.out.println(rs.getString("username"));
					System.out.println("1.Approve\n2.Deny");
					int n = sc.nextInt();sc.nextLine();
					if(n == 1) {
						pr.executeUpdate("UPDATE Login SET isApproved=1 where username = '" + rs.getString("username")+ "'");
						System.out.println("Successfully Approved..");
					}
					else if(n==2) {
						pr.executeUpdate("UPDATE Login SET isApproved=2 where username = '" + rs.getString("username") + "'");
					}
					else
						throw new NullPointerException("Please give valid input");
				}
			}
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
	}

	@Override
	public void generateReportCard() {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void addCourse(String course, String professor, int sem, float price) {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void addProfessor(String usernameP, String passwordP) {
		// TODO Auto-generated method stub
		String sql = "INSERT INTO Login VALUES(?,?,?,?)";
		try {
			pr = conn.prepareStatement(sql);
			pr.setString(1, usernameP);
			pr.setString(2, passwordP);
			pr.setString(3, "professor");
			pr.setInt(4, 1);
			pr.executeUpdate();
			
			
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		String pName =  usernameP.substring(0, 1).toUpperCase() + usernameP.substring(1, usernameP.indexOf("@gmail.com"));
		String sql1 = "INSERT INTO Professor VALUES(?,?,?)";
		
		try {
			pr = conn.prepareStatement(sql1);
			String sql2 = "SELECT MAX(professorId) FROM Professor";
			ResultSet rs = pr.executeQuery(sql2);
			int max1 = 0;
			while(rs.next()) {
			max1 = rs.getInt(1)+1;
			}
			pr.setInt(1, max1);
			pr.setString(2, usernameP);
			pr.setString(3, pName);
			pr.executeUpdate();
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		
		
	}

	@Override
	public void removeCourse(String course, String professor, int sem) {
		// TODO Auto-generated method stub
		
	}

}
