/**
 * 
 */
package com.tcs.dao;

import java.sql.*;
import java.sql.SQLException;
import java.util.Scanner;

import com.tcs.utils.DBUtils;

/**
 * @author Administrator
 *
 */
public class StudentDaoImp implements StudentDaoInterface{
	DBUtils cc = new DBUtils();
	Connection conn = null;
	PreparedStatement pr = null;
	Scanner sc = new Scanner(System.in);
	@Override
	public void addCourse(int courseId,String courseName, String professor, String username) {
		// TODO Auto-generated method stub
		conn = cc.connect();
		String sql1 = "SELECT Id FROM Student where username='" + username + "'";
		int sId =0;
		try {
			PreparedStatement pr1 = conn.prepareStatement(sql1);
			ResultSet rs = pr1.executeQuery();
			while(rs.next()) {
				sId = rs.getInt(1);
			}
			pr1.close();
			
		} catch (SQLException e1) {
			// TODO Auto-generated catch block
			e1.printStackTrace();
		}
		
		String sql = "INSERT INTO CourseRegistration Values("+ courseId +",'" + courseName + "','" + professor + "'," + sId +")";
		try {
			pr = conn.prepareStatement(sql);
			pr.executeUpdate();
			System.out.println("Successfully Added.");
			
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		try {
			conn.close();
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
	}

	@Override
	public void dropCourse(String courseName, String professor, String username) {
		// TODO Auto-generated method stub
		conn = cc.connect();
		String sql = "DELETE FROM CourseRegistration WHERE courseName='"+ courseName +"' AND pName='" + professor + "'";
		try {
			pr = conn.prepareStatement(sql);
			pr.executeUpdate();
			System.out.println("Successfully Removed.");
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		try {
			conn.close();
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
	}

	@Override
	public void viewReportCard(String username) {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void semesterRegistration(String username, int semester) {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void payFee(String username) {
		// TODO Auto-generated method stub
		conn = cc.connect();
		float bill = 0;
		int sId=0;
		String sql1 = "SELECT Id FROM Student WHERE username='" + username + "'";
		String sql = "SELECT SUM(coursePrice) FROM CourseRegistration cr INNER JOIN Catalog c USING(courseId) WHERE studentId=" +sId;
		String sql3 = "INSERT INTO Payment(studentId,bill,paymentMode) VALUES(?,?,?)";
		try {
			PreparedStatement pr1 = conn.prepareStatement(sql1);
			ResultSet rs1 = pr1.executeQuery(sql1);
			while(rs1.next()) {
				sId = rs1.getInt("Id");
			}
			pr1.close();
			pr = conn.prepareStatement(sql);
			ResultSet rs = pr.executeQuery(sql);
			while(rs.next()) {
				bill = rs.getFloat(0);
			}
			System.out.println("Your Bill : " + bill);
			System.out.println("Choose Payment Mode : ");
			System.out.println("1.Online/UPI Payment\n2.Credit/Debit Card\n3.Netbanking\n4.Pay by Cash");
			int n = sc.nextInt();sc.nextLine();
			String mode = null;
			switch(n) {
			case 1: mode = "Online/UPI Payment";break;
			case 2: mode = "Credit/Debit Card";break;
			case 3: mode = "Netbanking";break;
			case 4: mode = "Pay by Cash";break;
			default:throw new NullPointerException("Invalid Payment");
			}
			PreparedStatement pr2 = conn.prepareStatement(sql3);
			pr2.setInt(1, sId);
			pr2.setFloat(2, bill);
			pr2.setString(3, mode);
			pr2.executeUpdate();
			pr2.close();
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		try {
			conn.close();
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
	}

}
